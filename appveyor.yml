image: Visual Studio 2019
configuration: Release
test: off

before_build:
- ps: >-   
    cd v2rayN
    
    nuget restore -verbosity detailed

build:
  parallel: true
  verbosity: minimal

after_build:
- cmd:
    git describe --always --tags >OUTPUTFILE.TXT
    
    set /P GIT_TAG=<OUTPUTFILE.TXT
    
    7z x v2rayN-Core-bin\v2ray-windows.zip -ov2rayN\bin\Release
    
    copy v2rayN-Core-bin\geoip.dat   v2rayN\bin\Release /y
    
    copy v2rayN-Core-bin\geosite.dat v2rayN\bin\Release /y
    
    cd v2rayN\bin\Release
    
    7z a v2rayN.Portable.zip .
    
    move v2rayN.Portable.zip  ..\..\..\v2rayN.Portable-%GIT_TAG%.zip

artifacts:
- path: v2rayN\v2rayN\bin\Release
  name: v2rayN.Portable
- path: v2rayN\v2rayN.Portable-%GIT_TAG%.zip
  name: v2rayN.Portable-Version
  
on_success:
    - echo succeed

deploy:
  release: v2rayN %GIT_TAG%
  description: "Need to add."
  provider: GitHub
  auth_token:
    secure:  jjIUlINV2I/vxMzoH/jX11I6/rwEo237ELLgm37s3GdLQV3XkNbtVI/BVXjU4xSD
  artifact: v2rayN.Portable-Version
  draft: true
  prerelease: false
  on:
    APPVEYOR_REPO_TAG: true        # deploy on tag push only